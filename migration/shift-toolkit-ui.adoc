---
sidebar: sidebar 
permalink: migration/shift-toolkit-ui.html 
keywords: netapp, vmware, esxi, vm, migration, openshift, virtualization, hyper-v, proxmox 
summary:  
---
= 配置NetApp Shift 工具包
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
配置 Shift Toolkit 以自动化虚拟机的迁移或转换）此过程包括添加源站点和目标站点、配置存储、将虚拟机分组为资源组、创建迁移蓝图以及安排迁移。



== 运行 Shift 工具包

* 使用浏览器，通过输入以下命令访问 Shift 工具包 UI： `http://<IP address specified during installation>:3001`
+
注：为获得最佳体验，请使用谷歌浏览器或Internet Explorer。

* 使用以下默认凭据访问用户界面：用户名：admin 密码：admin
+
image::shift-toolkit-050.png[NetApp Shift Toolkit 登录屏幕示意图]

+
注意：管理员需要在首次登录时更改其凭据。

+
注意：强制更改密码后，管理员凭据也可以在登录 GUI 后使用“更改密码”选项进行更改。

+
image::shift-toolkit-051.png[NetApp Shift Toolkit 更改密码屏幕示意图]

+
完成后，点击“接受并继续”接受最终用户许可协议。

+
image::shift-toolkit-052.png[NetApp最终用户许可协议 (EULA) 截图]





== Shift Toolkit 配置

正确配置了源虚拟机和目标虚拟机的存储和连接后，即可开始配置 Shift 工具包，利用FlexClone功能自动将虚拟机迁移或转换为适当的格式。



=== 添加站点

第一步是发现并添加源虚拟机管理程序详细信息（包括虚拟机管理程序和存储），然后将源虚拟机管理程序详细信息添加到 Shift 工具包中。在受支持的浏览器中打开 Shift 工具包，使用默认用户名和密码，然后单击“添加站点”。

image::shift-toolkit-053.png[Shift Toolkit 添加站点对话框]

注意：也可以使用“发现”选项添加网站。

添加以下平台：



==== 源

* 源站点详细信息
+
** 站点名称- 提供站点的名称
** 虚拟机管理程序 – 选择 VMware 或 Hyper-V 作为源
** 站点位置 – 选择默认选项
** 连接器 – 选择默认选择




填写完成后，单击“继续”。

image::shift-toolkit-054.png[Shift Toolkit 添加新站点对话框]

* 如果选择 VMware，请输入源 vCenter 的详细信息。
+
** 端点 - 输入 vCenter 服务器的 IP 地址或 FQDN
** 用户名 - 访问 vCenter 的用户名（UPN 格式：username@domain.com）
** vCenter 密码 – 用于访问 vCenter 以执行资源清单的密码。
** vCenter SSL 指纹（可选）


* 如果选择的是 Hyper-V，请输入源 Hyper-V 详细信息。
+
** 端点 - 输入独立主机或故障转移集群端点的 IP 地址或 FQDN。
** Hyper-V 用户名 - 用于访问 Hyper-V 的用户名（采用下级登录名 (域\用户名) 或 UPN 格式）
** Hyper-V 密码 – 用于访问 Hyper-V 以执行资源清点的密码。
+
 Select “Accept Self signed certificate” and click Continue.


* ONTAP存储系统凭据


image::shift-toolkit-055.png[Shift Toolkit 添加新站点对话框]

一旦添加，Shift 工具包将执行自动发现并显示虚拟机以及相关的元数据信息。Shift 工具包将自动检测虚拟机使用的网络和 VLAN，并填充它们。

注意：如果对源站点进行了任何修改，请务必运行发现程序以获取最新信息。您可以通过点击网站名称旁边的三个点，然后点击“发现网站”来完成此操作。

注意：虚拟机清单每 24 小时自动刷新一次。

image::shift-toolkit-056.png[使用 Shift Toolkit 的“添加新站点”对话框来发现站点]

要查看特定源虚拟机管理程序的发现数据，请转到仪表板，单击相应站点名称旁边的“查看虚拟机列表”。该页面将显示虚拟机清单以及虚拟机属性。

image::shift-toolkit-057.png[Shift Toolkit 发现站点的对话]

下一步是添加目标虚拟机管理程序。要添加，请点击“添加新站点”，然后选择“目标”。



==== 目标

image::shift-toolkit-058.png[Shift Toolkit 添加站点对话框（目标位置）]

* 目的地详情
+
** 站点名称- 提供站点的名称
** 虚拟机管理程序 – 从以下选项中选择合适的目标平台：
+
*** VMware
*** Hyper-V
*** OpenShift
*** OLVM
*** KVM（仅限转换）


** 站点位置 – 选择默认选项
** 连接器 – 选择默认选择




填写完成后，单击“继续”。

image::shift-toolkit-059.png[Shift Toolkit 添加站点对话框，用于显示目标详细信息]

根据虚拟机管理程序的选择，填写必要的详细信息。

* 目标虚拟机管理程序详情
+
** 相应的虚拟机管理程序管理器端点 IP 地址或 FQDN
** 用户名 - 用于访问的用户名（UPN 格式：username@domain.com 或 domain\administrator） 密码 - 用于执行资源清点的访问密码。




选择“接受自签名证书”。

* 完成后，点击“创建网站”。


注意：源存储系统和目标存储系统应该相同，因为磁盘格式转换是在卷级别且在同一卷内进行的。

image::shift-toolkit-060.png[Shift Toolkit 添加站点对话框，用于显示目标详细信息]

下一步是将所需的虚拟机作为资源组分组到其迁移组中。



=== 资源分组

添加平台后，将要迁移或转换的虚拟机分组到资源组中。  Shift 工具包资源组允许您将从属虚拟机集分组为包含其启动顺序和启动延迟的逻辑组。

注意：在创建资源组之前，请确保已配置 Qtree（如先决条件部分所述）。

要开始创建资源组，请点击“创建新资源组”菜单项。

. 访问资源组，点击“创建新资源组”。
+
image::shift-toolkit-061.png[创建新资源组用户界面的对话框]

. 在“新建资源组”中，从下拉菜单中选择源站点，然后单击“创建”。
. 提供资源组详细信息并选择工作流。工作流程提供了两个选项
+
.. 基于克隆的迁移——执行从源虚拟机管理程序到目标虚拟机管理程序的端到端虚拟机迁移。
.. 基于克隆的转换 - 将磁盘格式转换为所选的虚拟机管理程序类型。
+
image::shift-toolkit-062.png[创建新资源组用户界面的对话框]



. 点击“继续”
. 使用搜索选项选择合适的虚拟机。默认筛选选项为“数据存储”。
+
注意：在转换之前，请将虚拟机移动到新创建的ONTAP SVM 上的指定数据存储进行转换或迁移。这有助于隔离生产 NFS 数据存储，并且指定的数据存储可用于暂存虚拟机。

+
注意：对于 OpenShift 环境，应将 VMDK 迁移到其对应的卷，以便使用ONTAP NAS 存储驱动程序复制 PVC（持久卷声明）结构。在未来的版本中，我们将加入更多增强功能，以充分利用ONTAP NAS 经济型驱动程序。

+
image::shift-toolkit-063.png[创建新资源组用户界面的对话框]

+
注意：在此上下文中，数据存储下拉菜单只会显示 NFSv3 数据存储。NFSv4 数据存储将不会显示。

+
image::shift-toolkit-064.png[创建新资源组用户界面的对话框]

. 通过选择“目标站点”、“目标虚拟机管理程序条目”和数据存储到 Qtree 或存储类映射来更新迁移详细信息。
+
image::shift-toolkit-065.png[创建新资源组用户界面的对话框]

+
注意：转换虚拟机时，请确保目标路径（存储转换后的虚拟机的位置）设置为 qtree。将目标路径设置为相应的 qtree。

+
注意：可以创建多个 qtree 并用于相应地存储转换后的 VM 磁盘。

+
注意：虚拟机可以在跨存储区上运行，Shit 工具包会自动检测到它们，但是每个卷都应该映射一个 qtree。

+
能够将具有跨多个卷的 VMDK 的虚拟机迁移 Shift 工具包 UI 会自动选择属于特定 RG 的虚拟机或虚拟机的所有跨卷。这将列出 RG 页面中所有卷，我们在该页面进行数据存储 - qtree 映射。

+
image::shift-toolkit-066.png[创建新资源组用户界面的对话框]

. 为所有选定的虚拟机选择启动顺序和启动延迟（秒）。通过选择每个虚拟机并设置其优先级来设置开机顺序。3 是所有虚拟机的默认值。选项如下：1 – 第一个启动的虚拟机；3 – 默认值；5 – 最后启动的虚拟机
+
image::shift-toolkit-067.png[创建新资源组用户界面的对话框]

. 点击“创建资源组”。
+
image::shift-toolkit-068.png[创建新资源组用户界面的对话框]

+
注意：如果需要修改资源组以添加或删除虚拟机，请使用此选项选中资源组名称，然后选择“编辑资源组”。





=== 蓝图

要迁移或转换虚拟机，必须制定计划。从下拉菜单中选择源和目标虚拟机管理程序平台，并选择要包含在此蓝图中的资源组，以及应用程序启动方式的分组（即域控制器，然后是第 1 层，然后是第 2 层，等等）。这些通常也被称为迁移计划。要定义蓝图，请导航至“蓝图”选项卡，然后单击“创建新蓝图”。

要开始创建蓝图，请点击“创建新蓝图”。

. 访问蓝图，点击“创建新蓝图”。
+
image::shift-toolkit-069.png[访问蓝图用户界面的对话框]

. 在“新建蓝图”中，为计划命名，并通过选择源站点 > 关联的 vCenter、目标站点和关联的虚拟机管理程序来添加必要的主机映射。
. 映射完成后，选择集群和主机映射。在下面的示例中，Hyper-V 被显示为目标。根据所选源站点的不同，显示的虚拟机管理程序选项也会有所不同。
+
image::shift-toolkit-070.png[创建新蓝图用户界面对话框]

. 选择资源组详细信息，然后点击“继续”。
+
image::shift-toolkit-071.png[创建新蓝图用户界面对话框]

. 设置资源组的执行顺序。当存在多个资源组时，此选项可以选择操作顺序。
. 完成前面的步骤后，选择网络映射并将其分配给相应的网络映射。确保目标虚拟机管理程序上已配置虚拟交换机、网络配置文件或运营商。
+
image::shift-toolkit-072.png[创建新蓝图用户界面对话框]

+
注意：对于测试迁移，“不配置网络”是默认选择，Shift 工具包不会执行 IP 地址分配。磁盘转换完成后，在相应的虚拟机管理程序端购买虚拟机，手动分配气泡网络交换机，以避免与生产网络发生任何冲突。

+
image::shift-toolkit-073.png[创建新蓝图用户界面对话框]

. 根据虚拟机的选择，将自动选择存储映射。
+
注意：请确保事先已配置 qtree 并分配了必要的权限，以便可以创建虚拟机并启动它。注意：对于 OpenShift，PVC 是使用Trident CSI 创建的，无需预先创建 qtree。

. 在虚拟机详细信息下，为每种操作系统类型提供服务帐户和有效用户凭据。这用于连接到虚拟机以创建和运行删除 VMware 工具和备份 IP 配置详细信息所需的某些脚本。
+
.. 对于基于 Windows 的操作系统，建议使用具有本地管理员权限的用户。也可以使用域凭据，但是请确保在转换之前虚拟机上存在用户配置文件，否则域凭据将无法工作，因为它会在没有网络连接时查找域身份验证。
.. 对于基于 Linux 发行版的客户虚拟机，提供一个无需密码即可执行 sudo 命令的用户，这意味着该用户应该属于 sudoers 列表，或者作为新的配置文件添加到 /etc/sudoers.d/ 文件夹中。
+
image::shift-toolkit-074.png[创建新蓝图用户界面对话框]

+
在最近发布的版本中，Shift Toolkit 在虚拟机准备方面引入了更大的灵活性。默认情况下，该工具包通过部署特定于操作系统的脚本来自动准备虚拟机，以：* 移除 VMware Tools * 备份 IP 设置以便根据所选蓝图重新分配

+
+ 通过这项新增强功能，用户现在可以覆盖默认的 prepareVM 任务，从而能够执行自定义脚本以手动准备 VM，包括 IP 分配。这为具有特殊配置或合规性要求的环境提供了更大的控制权。



. 再次在 VM 详细信息下，选择相关的 IP 配置选项。默认情况下，选择“不配置”。
+
.. 要将具有相同 IP 地址的虚拟机从源系统迁移过来，请选择“保留 IP”。
.. 要迁移源系统中使用静态 IP 地址的虚拟机，并在目标虚拟机上分配 DHCP，请选择“DHCP”。
+
请确保满足以下要求才能使此功能正常工作：

+
*** 确保虚拟机在 prepareVM 阶段以及预定的迁移时间内处于开启状态。
*** 对于 VMware VM，请确保已安装 VMware Tools。
*** 如果源虚拟机管理程序是 Hyper-V，请确保已启用并配置集成服务。
*** 对于以 OLVM 和 OpenShift 为目标虚拟机管理程序的情况，请确保将 virtIO ISO 文件挂载到 Windows 虚拟机。
*** 确保使用具有管理员权限的帐户在源虚拟机上运行准备脚本（Windows 操作系统）或使用 sudo 权限且不带密码选项的帐户（Linux 发行版操作系统），以创建 cron 作业。




. 下一步是虚拟机配置。
+
** 可选择调整虚拟机的 CPU/RAM 参数，这对于调整大小非常有帮助。
** 启动顺序覆盖：还修改资源组中所有选定虚拟机的启动顺序和启动延迟（秒）。如果需要对资源组启动顺序选择期间选择的内容进行任何更改，这是一个用于修改启动顺序的附加选项。默认情况下，使用资源组选择期间选择的启动顺序，但可以在此阶段进行任何修改。
** 开启：如果工作流程不应开启虚拟机，请取消选中此选项。默认选项为 ON，表示虚拟机将开启。
** 删除 VMware 工具：Shift 工具包在转换后删除 VMware 工具。默认情况下选择此选项。如果计划执行客户自己的定制脚本，则应取消选择此项。
** 生成：Shift 工具包使用以下经验法则并默认为适当的规则 - Gen1 > BIOS 和 Gen2 > EFI。此选项无法选择。
** 保留 MAC：可以保留各个虚拟机的 MAC 地址，以克服依赖 MAC 的应用程序的许可挑战。
** 服务帐户覆盖：如果无法使用全局服务帐户，则此选项允许指定单独的服务帐户。
+
image::shift-toolkit-075.png[资源组用户界面对话框]



. 点击“继续”。
. 在下一步中，通过选中复选框来设置日期和时间来安排迁移。确保所有虚拟机 (VM) 在预定日期之前准备好并关闭。完成后，点击“创建蓝图”。
+
image::shift-toolkit-076.png[资源组用户界面对话框]

+
注意：安排日程时，请选择比当前 Shift VM 时间至少提前 30 分钟的日期。这是为了确保工作流程有足够的时间来准备资源组内的虚拟机。

. 创建蓝图后，将启动 prepareVM 作业，并自动在源虚拟机上运行脚本以准备迁移
+
image::shift-toolkit-077.png[资源组用户界面对话框]

+
此作业使用invoke-VMScript方法运行脚本，复制删除VMware工具和备份网络配置详细信息所需的脚本，包括IP地址、路由和DNS信息，这些信息将用于在目标VM上维护相同的设置。

+
.. 对于基于 Windows 的操作系统，准备脚本的默认存储位置是“C:\ NetApp”文件夹。
+
image::shift-toolkit-078.png[资源组用户界面对话框]

.. 对于基于 Linux 的虚拟机，准备脚本的默认存储位置是 / NetApp和 /opt 目录。
+
image::shift-toolkit-079.png[资源组用户界面对话框]

+
注意：对于运行 CentOS 或 Red Hat 的 Linux 源虚拟机，Shift 工具包能够智能地自动安装必要的 Hyper-V 驱动程序。这些驱动程序必须在磁盘转换之前存在于源 VM 中，以确保 VM 在转换后能够成功启动。

+
注：详细信息请参阅link:https://access.redhat.com/solutions/3465011["将 RHEL VM 迁移到 Hyper-V 后，系统陷入 dracut 状态"]。

+
一旦 prepareVM 作业成功完成（如下面的屏幕截图所示），虚拟机就可以进行迁移，并且蓝图状态将更新为“活动”。

+
image::shift-toolkit-080.png[资源组用户界面对话框]

+
image::shift-toolkit-081.png[资源组用户界面对话框]

+
迁移将在设定的时间进行，或者可以通过单击“迁移”选项手动启动。




