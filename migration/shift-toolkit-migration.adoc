---
sidebar: sidebar 
permalink: migration/shift-toolkit-migration.html 
keywords: netapp, vmware, esxi, vm, migration, openshift, virtualization, hyper-v, proxmox, shift, toolkit 
summary: 使用 Shift Toolkit 在虚拟化平台之间迁移虚拟机。该过程包括准备虚拟机、转换磁盘格式以及在目标环境中配置网络设置。 
---
= 使用 Shift Toolkit 迁移虚拟机
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
使用 Shift Toolkit 在虚拟化平台之间迁移虚拟机。该过程包括准备虚拟机、转换磁盘格式以及在目标环境中配置网络设置。



== 支持的迁移

Shift Toolkit 通过支持以下虚拟机管理程序之间的双向迁移，为多虚拟机管理程序环境提供了灵活性：

* link:shift-toolkit-migrate-esxi2hyperv.html["VMware ESXi 到 Microsoft Hyper-V"]
* link:shift-toolkit-migrate-hyperv2esxi.html["Microsoft Hyper-V 到 VMware ESXi"]
* link:shift-toolkit-migrate-esxi2olvm.html["VMware ESXi 到 Oracle Linux Virtualization Manager (OLVM)"]
* link:shift-toolkit-migrate-esxi2osv.html["VMware ESXi 到 Red Hat OpenShift 虚拟化"]




== 迁移工作流程

创建蓝图后，即可启动迁移过程。在迁移过程中，Shift Toolkit 会执行一系列步骤来转换磁盘格式，并按照蓝图中的定义在目标主机上创建虚拟机。

Shift Toolkit 在迁移过程中执行以下步骤：

. 删除蓝图中所有虚拟机的现有快照
. 触发源蓝图的虚拟机快照
. 磁盘转换前触发卷快照
. 克隆所有虚拟机的 VMDK 并将其转换为 VHDx 格式
. 在目标位置启动保护组中的虚拟机
. 在每个虚拟机上注册网络
. 移除 VMware Tools，并根据操作系统类型使用触发脚本或 cron 作业分配 IP 地址。




== 网络技巧和注意事项

规划迁移时，请考虑以下网络要求和行为。  Shift Toolkit 会自动从源虚拟机复制网络设置并将其重新应用于迁移的虚拟机，但 Windows 和 Linux 系统之间的接口命名和网络适配器配置可能有所不同。

.一般要求
* 确保静态 IP 地址可用且未分配给其他虚拟机。


.Windows虚拟机
* 准备脚本会复制网络配置详细信息（IP 地址空间、网关地址、DNS 服务器）。
* 触发脚本会在迁移过程中，根据蓝图映射，为单个或多个网卡重新应用网络设置。
* 迁移后，Windows 设备管理器可能会显示迁移前的旧网络适配器信息，但这不会影响新适配器，也不会导致 IP 地址冲突。
* 升级到 v4.0 版本，即可自动从注册表和设备管理器中删除孤立的网络设备。


.Linux虚拟机
* 准备脚本会复制网络配置详细信息（IP 地址空间、路由、DNS 服务器、网络设备名称）。
* 该脚本会识别 Linux 发行版的网络类型，并据此应用相应的 IP 设置。
* 网络重分配脚本已配置为 cron 作业，使用 crontab 进行设置，并在启动时触发。
* 该脚本根据蓝图映射重新应用单个或多个网卡的网络设置。


.接口命名
* 转换后的虚拟机可能具有类似这样的接口名称 `eth0`或者 `ensp0`而不是源接口名称（例如， `ens192`或者 `ens33`）
* 该脚本会更新网络配置详细信息，使其与新的接口名称相匹配。
* 如果使用符合 udev 匹配规则的可预测名称，并且目标虚拟机管理程序上保留了接口名称，则脚本会跳过网络配置，移除 VMware Tools，并重启虚拟机。



NOTE: Shift Toolkit 允许覆盖网络准备，使管理员能够运行自定义脚本进行 IP 分配或其他配置。

.支持的网络机制
* 网络管理器
* 内特普兰
* ifconfig
* 邪恶


Shift Toolkit 会保留蓝图中指定的 IP 地址。



== 迁移阶段

以下是使用 Shift Toolkit 迁移虚拟机时需要遵循的迁移阶段。

. *准备虚拟机*：准备迁移所需的虚拟机，并验证所有先决条件是否已完成。
. *迁移和验证*：准备工作完成后，将 VMware 虚拟机迁移到目标虚拟机管理程序。
+
迁移完成后，验证虚拟机是否成功启动以及数据是否已正确迁移。

. *测试迁移*：测试迁移通过将 VMDK 转换为适当的格式，并在 qtree 上使用转换后的虚拟磁盘文件创建虚拟机来模拟迁移。
+
测试迁移不包括网络映射配置，该配置应手动执行到测试网络。




NOTE: Shift Toolkit 不会更改源虚拟机，只会复制虚拟机准备所需的脚本。这样可以在转换失败的情况下迅速回滚。



== 执行迁移

要使用蓝图中指定的配置触发迁移工作流，请单击“迁移”。

image::shift-toolkit-030.png[显示如何触发虚拟机迁移的对话框]

一旦启动，工作流程就会激活，转换过程将按照概述的步骤注册虚拟机。如果蓝图中的虚拟机未关闭电源，Shift Toolkit 会在继续操作之前提示用户进行正常关机。

image::shift-toolkit-031.png[迁移过程确认]


NOTE: NetApp建议从同一源到同一目标并行触发的转换次数不要超过十次。

image::shift-toolkit-032.png[迁移进度]

VMDK 转换为任何文件格式只需几秒钟即可完成，这是目前最快的选择。这种方法有助于减少迁移过程中虚拟机的停机时间。

image::shift-toolkit-033.png[磁盘转换进度]

任务完成后，蓝图状态将变为“迁移完成”。

image::shift-toolkit-034.png[迁移已完成状态]
