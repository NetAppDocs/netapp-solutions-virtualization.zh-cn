---
sidebar: sidebar 
permalink: migration/shift-toolkit-settings.html 
keywords: netapp, vmware, esxi, vm, migration, openshift, virtualization, hyper-v, proxmox 
summary: 在 Shift Toolkit 中配置高级设置，以管理 CredSSP 身份验证、启用日志记录和调试、访问 REST API 以及设置迁移作业的电子邮件通知。 
---
= 在 Shift 工具包中配置高级设置
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
在 Shift Toolkit 中配置高级设置，以管理 CredSSP 身份验证、启用日志记录和调试、访问 REST API 以及设置迁移作业的电子邮件通知。

点击顶部工具栏中的“设置”图标，即可访问高级设置。

image::shift-toolkit-250.png[Shift Toolkit 工具栏中的“设置”图标]



== 凭证安全服务提供商 (CredSSP)

Shift Toolkit 使用凭证安全服务提供商 (CredSSP) 来管理转换过程中的凭证传输。  Shift 服务器在被转换的虚拟机的客户操作系统上运行脚本，通过 Hyper-V 服务器从 Shift 服务器向客户操作系统“双跳”传递凭据。

image::shift-toolkit-251.png[CredSSP 配置设置]



=== 将 Shift 服务器配置为 CredSSP 客户端

高级设置向导会自动将 Shift 服务器配置为 CredSSP 客户端，使其能够将凭据委派给 Hyper-V 服务器。



==== 幕后花絮

Shift Toolkit 执行以下命令和策略配置，将自身设置为客户端：

*已执行的命令：*

* `Set-Item WSMan:\localhost\Client\TrustedHosts -Value "fqdn-of-hyper-v-host"`
* `Enable-WSManCredSSP -Role client -DelegateComputer "fqdn-of-hyper-v-host"`


*已配置组策略：*

* 计算机配置 > 管理模板 > 系统 > 凭据委派 > 允许使用仅 NTLM 服务器身份验证委派新凭据
+
启用此策略并添加 `wsman/fqdn-of-hyper-v-host`。





=== 将 Hyper-V 服务器配置为 CredSSP 服务器

使用 `Enable-WSManCredSSP`使用 Hyper-V 服务器上的 cmdlet 将其配置为 CredSSP 服务器，使其能够从 Shift 服务器接收凭据。

.步骤
. 在 Shift Toolkit 服务器将要配置虚拟机的 Hyper-V 主机上，以管理员身份打开 Windows PowerShell 会话。
. 运行以下命令：
+
[listing]
----
Enable-PSRemoting
Enable-WSManCredSSP -Role server
----




== 日志记录和调试

Shift Toolkit 包含默认日志记录功能，保留期限为 30 天。根据技术支持的要求，日志记录可以切换到调试模式，以便进行故障排除。

image::shift-toolkit-252.png[日志配置设置]



== 昂首阔步

高级设置中的 Swagger 页面允许您与 Shift Toolkit REST API 进行交互。

image::shift-toolkit-253.png[Swagger API 文档接口]

Shift Toolkit REST API 提供对迁移、转换和自动化功能的编程访问。  API 按功能性工作流程组织，以帮助您快速找到完成特定任务所需的资源。

image::shift-toolkit-254.png[API资源类别]



=== 身份验证和设置 API

使用这些 API 来建立连接、管理用户以及配置 Shift Toolkit 服务器的身份验证。

*会议*

管理用户身份验证并获取 API 请求的授权令牌：

* 开始会话
* 验证会话
* 获取所有会话 ID
* 结束会话


*用户*

管理用户帐户和权限：

* 添加用户
* 获取所有用户
* 更改用户密码
* 接受 EULA


*CredSSP*

配置凭据安全服务提供商以进行凭据委派：

* 启用 CredSSP
* 获取 CredSSP 状态


*连接器*

管理与基础架构组件的连接：

* 添加连接器
* 获取所有连接器的详细信息
* 按 ID 更新连接器详细信息
* 通过 ID 获取连接器详细信息


*租户*

管理多租户配置：

* 添加租户
* 获取所有租户信息




=== 基础设施管理 API

使用这些 API 来配置和发现您的源环境和目标环境。

*地点*

管理迁移站点及其相关的虚拟和存储环境：

* 获取网站数量
* 获取所有站点详细信息
* 添加站点
* 通过 ID 获取站点详细信息
* 根据 ID 删除站点
* 向站点添加虚拟环境
* 将存储环境添加到站点
* 获取站点的虚拟环境详细信息
* 更新站点的虚拟环境详细信息
* 删除站点的虚拟环境详细信息
* 获取站点的存储环境详细信息
* 更新站点的存储环境详细信息
* 删除站点的存储环境详细信息


*发现*

发现并清点源站点和目标站点中的虚拟机和资源：

* 发现源站点
* 获取源站点的所有发现请求
* 发现目标站点
* 获取目标站点的所有发现请求
* 通过 ID 获取源站点的发现步骤
* 通过 ID 获取目标站点的发现步骤




=== 虚拟机和资源管理 API

使用这些 API 来清点、组织和管理虚拟机和资源以进行迁移。

*虚拟机*

查询和管理虚拟机：

* 获取源中的站点和虚拟环境的虚拟机
* 为站点和虚拟环境获取未受保护的虚拟机
* 获取虚拟机数量
* 获取受保护的虚拟机数量


*资源*

查看资源利用率和可用性：

* 获取站点和虚拟环境的资源详细信息
* 获取源站点资源数量


*资源组*

将虚拟机组织成保护组以便进行迁移：

* 获取保护组数量
* 获取所有保护组详细信息
* 添加保护组
* 通过 ID 获取保护组详细信息
* 通过 ID 删除保护组
* 按 ID 更新保护组详细信息
* 按 ID 获取保护组中的虚拟机
* 获取包含保护组的蓝图




=== 迁移和恢复 API

使用这些 API 来执行迁移、监控合规性和管理恢复操作。

*蓝图*

定义和管理迁移蓝图：

* 获取蓝图数量
* 获取所有蓝图详细信息
* 添加蓝图
* 通过 ID 获取蓝图详情
* 按ID删除蓝图
* 更新 ID 的蓝图详情
* 获取蓝图的虚拟机
* 获取蓝图中虚拟机的电源状态


*遵守*

迁移前请确认准备情况和兼容性：

* 获取蓝图的合规性检查结果
* 获取蓝图的合规性检查最终状态
* 为蓝图添加按需合规性检查


*执行*

监控迁移和转换作业的执行情况：

* 获取所有执行细节
* 获取正在执行的详细信息
* 获取执行次数
* 获取正在进行的执行次数
* 获取执行 ID 的步骤


*恢复*

执行和管理迁移和恢复操作：

* 为蓝图添加新的执行请求
* 为蓝图添加执行重试请求
* 获取所有蓝图的执行状态
* 获取蓝图 ID 的执行状态




=== 自动化 API

使用这些 API 来扩展和自动化 Shift Toolkit 的功能。

*脚本块*

访问并执行自动化脚本：

* 获取所有脚本元数据
* 通过 ID 获取脚本元数据
* 获取所有刷新元数据
* 执行脚本




== 脚本块和自动化

Shift Toolkit 中的脚本块提供了示例代码，可帮助您使用内部和外部 API 实现自动化、集成和开发功能。浏览并下载代码示例部分中的示例，这些示例由 Shift Toolkit 自动化团队和社区成员编写。使用这些示例开始执行自动化、管理或集成任务。

image::shift-toolkit-255.png[脚本块接口]

image::shift-toolkit-256.png[可用的代码示例]

以下示例展示了一个 PowerShell 脚本，用于删除 Shift Toolkit UI 中的特定作业。虽然标准工作流程中没有提供此功能，但可以使用脚本块来实现。该脚本还可以作为批处理脚本提供，可以轻松下载和执行。

image::shift-toolkit-257.png[用于删除作业的 PowerShell 脚本示例]

脚本块的目标是提供使用 Shift Toolkit API 和相应虚拟机管理程序发布的 API 在特定虚拟机管理程序上进行第 0 天和持续操作的示例脚本。

脚本块的目标是提供使用 Shift Toolkit API 和相应虚拟机管理程序发布的 API 在特定虚拟机管理程序上进行第 0 天和持续操作的示例脚本。



== 电子邮件通知和提醒

配置电子邮件通知，向指定收件人发送有关发现、转换或迁移作业的警报。  UI 通知（界面内的警报）也可用，并存储 7 天。

从“设置”>“平台设置”>“电子邮件配置”访问电子邮件通知设置。

.步骤
. 登录到 Shift Toolkit 用户界面。
. 前往“设置”>“平台设置”。
. 选择电子邮件通知并更新 SMTP 详细信息：
+
** SMTP 服务器地址
** 端口
** 用户名
** 密码


. 更新收件人字段，并从可用类别中选择事件。
. 单击“*应用*”。


image::shift-toolkit-258.png[电子邮件通知配置设置]

截图显示了每个通知类别和事件的详细分类。


NOTE: 此版本中，电子邮件通知使用基本的 SMTP 身份验证和 SendGrid。未来的版本将支持现代身份验证。


NOTE: 此版本中，电子邮件通知使用基本的 SMTP 身份验证和 SendGrid。未来的版本将支持现代身份验证。



== 中止并恢复功能

Shift Toolkit 提供了在工作流程的任何步骤取消正在运行的作业的选项。取消作业时，所有孤立组件都会自动清理，包括：

* 如果虚拟机已启动，则在虚拟机管理程序上将其关闭。
* 从相应的 qtree 中移除磁盘条目
* 删除持续性销量声明 (PVC)


由于 Shift Toolkit 不会以任何方式修改源虚拟机，因此回滚非常简单，只需启动源虚拟机即可。无需采取其他回滚操作。
