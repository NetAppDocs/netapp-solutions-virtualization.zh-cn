---
sidebar: sidebar 
permalink: vmware/vmw-vcf-mgmt-nfs.html 
keywords: netapp, vmware, cloud, foundation, vcf, aff, all-flash, nfs, array, ontap tools, otv, sddc, sddc manager, ontap tools, ontap tools 10 
summary:  
---
= 将 vCenter 服务器实例转换为 VCF 管理域（NFS 数据存储）
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
将具有NetApp ONTAP NFS 数据存储区的现有 vSphere 8 集群转换为 VMware Cloud Foundation (VCF) 管理域。此过程包括配置 NFS 存储、为 VMware 部署ONTAP工具以及使用 VCF 导入工具转换集群以简化管理和优化 VCF 内的资源利用率。



== 简介

转换在ONTAP上运行现有 NFS 数据存储的集群涉及将现有基础架构集成到现代私有云架构中。此过程受益于 NFS 存储的灵活性，以确保无缝的数据访问和管理。通过转换过程建立 VCF 管理域后，管理员可以有效地将其他 vSphere 集群（包括使用 NFS 数据存储的集群）导入 VCF 生态系统。这种集成不仅提高了资源利用率，还简化了私有云基础设施的管理，确保了平稳过渡，并且对现有工作负载的干扰最小。

在此解决方案中，我们将演示当集群转换为 VCF 管理域时，vSphere 8 中的 NFS 数据存储如何成为主要存储。



== 场景概述

此场景涵盖以下高级步骤：

* ONTAP tools for VMware vSphere。
* 使用ONTAP工具配置 NFS 数据存储库。
* 使用 VCF 导入工具验证 vSphere 集群。
* 在 vSphere 集群中部署 SDDC 管理器。
* 配置 JSON 文件以在 VCF 转换期间创建 NSX。
* 使用 VCF 导入工具将 vSphere 8 集群转换为 VCF 5.2。




== 前提条件

此场景需要以下组件和配置：

* NetApp AFF存储系统，其存储虚拟机 (SVM) 配置为允许 NFS 流量。
* 已在 IP 网络上创建用于承载 NFS 流量并与 SVM 关联的逻辑接口 (LIF)。
* 一个 vSphere 8 集群，其中有 4 个 ESXi 主机和一个位于该集群上的 vCenter 设备。
* 为 vMotion 和 NFS 存储流量在为此目的建立的 VLAN 或网络段上配置的分布式端口组。
* 下载 VCF 转换所需的软件。


ONTAP tools for VMware vSphere可以安装在 HA 或非 HA 配置中。有关ONTAP工具前提条件的完整信息，请参阅 https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/deploy/prerequisites.html#system-requirements["适用于ONTAP tools for VMware vSphere的先决条件"]。

有关将 vSphere 转换或导入 VCF 5.2 时支持的存储和其他注意事项，请参阅 https://techdocs.broadcom.com/fr/fr/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/considerations-before-converting-or-importing-existing-vsphere-environments-into-vcf.html["将现有 vSphere 环境转换或导入 VMware Cloud Foundation 之前的注意事项"]。

对于所需的软件，请访问 https://support.broadcom.com/["Broadcom 支持门户"]。

有关配置ONTAP存储系统的信息，请参阅link:https://docs.netapp.com/us-en/ontap["ONTAP 9 文档"]中心。

有关配置 VCF 的信息，请参阅link:https://techdocs.broadcom.com/us/en/vmware-cis/vcf.html["VMware 云基础文档"]。



== 部署步骤

该解决方案涵盖使用ONTAP tools for VMware vSphere来配置 NFS 数据存储以及将现有 vSphere 8 集群转换为 VCF 管理域的过程。

完成以下步骤：

* ONTAP tools for VMware vSphere。
* 使用ONTAP工具配置 NFS 数据存储库。
* 将 VCF 导入工具复制到 vCenter 设备。
* 使用 VCF 导入工具对 vCenter 设备运行预检查。
* 在 vCenter 集群上部署 SDDC 管理器虚拟机。
* 为 NSX 群集创建一个 JSON 文件，以便在转换过程中进行部署。
* 将所需软件上传到 SDDC 管理器。
* 将 vSphere 集群转换为 SDDC 管理器清单。


有关转换过程的概述，请参阅 https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/map-for-administering-vcf-5-2/importing-existing-vsphere-environments-admin/convert-or-import-a-vsphere-environment-into-vmware-cloud-foundation-admin.html["在 VMware Cloud Foundation 中将 vSphere 环境转换为管理域或将 vSphere 环境导入为 VI 工作负载域"]。



=== 部署ONTAP工具并配置 NFS 数据存储库

ONTAP工具 10 的架构旨在与 VMware 环境无缝集成，利用包含ONTAP工具服务、vSphere 插件和 REST API 的模块化可扩展框架实现高效的存储管理、自动化和数据保护。

ONTAP tools for VMware vSphere可以安装在 HA 或非 HA 配置中。

image:vmware-vcf-import-nfs-010.png["ONTAP工具架构"]

.ONTAP tools for VMware vSphere
[%collapsible%open]
====
在此步骤中， ONTAP工具 10 采用非 HA 配置进行部署。

有关 HA 和非 HA 配置的更多部署详细信息，请参阅 https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/deploy/ontap-tools-deployment.html["ONTAP tools for VMware vSphere"]。

. ONTAP https://mysupport.netapp.com/site/["NetApp支持站点"]。
. 在 vSphere 客户端中，右键单击集群，然后单击“部署 OVF 模板”
+
image:vmware-vcf-import-nfs-001.png["部署 OVF 模板"]

+
{nbsp}

. 在*部署 OVF 模板*中完成以下步骤：
+
** 选择一个 OVF 模板。
** 选择名称和文件夹。
** 选择计算资源。
** 查看详细信息。
** 同意许可协议。


. 在模板的*配置*页面上，选择部署类型，包括是否在 HA 配置中部署ONTAP工具。单击“*下一步*”继续。
+
image:vmware-vcf-import-nfs-002.png["配置 - 部署类型"]

+
{nbsp}

. 在*选择存储*页面上选择要安装虚拟机的数据存储，然后单击*下一步*。
. 选择ONTAP工具 VM 将在其上进行通信的网络。单击“*下一步*”继续。
. 在“自定义模板”窗口中，填写所有必需的信息。
+
** 应用程序用户名和密码
** 选择是否启用包括代理 URL 的 ASUP（自动支持）。
** 管理员用户名和密码。
** NTP 服务器。
** 维护用户名和密码（控制台使用的维护帐户）。
** 提供部署配置所需的 IP 地址。
** 提供节点配置的所有网络信息。
+
image:vmware-vcf-import-nfs-003.png["自定义模板"]

+
{nbsp}



. 最后，单击“*下一步*”继续，然后单击“*完成*”开始部署。


====
.配置ONTAP工具
[%collapsible%open]
====
一旦安装并启动ONTAP工具 VM，就需要进行一些基本配置，例如添加 vCenter 服务器和ONTAP存储系统进行管理。请参阅以下文档 https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/index.html["ONTAP tools for VMware vSphere文档"]了解详细信息。

. 参考 https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/configure/add-vcenter.html["添加 vCenter 实例"]配置要使用ONTAP工具管理的 vCenter 实例。
. 要添加ONTAP存储系统，请登录 vSphere 客户端并导航到左侧的主菜单。单击“NetApp ONTAP工具”以启动用户界面。
+
image:vmware-vcf-import-nfs-004.png["打开ONTAP工具"]

+
{nbsp}

. 导航到左侧菜单中的“*存储后端*”，然后单击“*添加*”以访问“*添加存储后端*”窗口。
. 填写要管理的ONTAP存储系统的 IP 地址和凭据。单击“*添加*”完成。
+
image:vmware-vcf-import-nfs-005.png["添加存储后端"]




NOTE: 这里，使用集群 IP 地址在 vSphere 客户端 UI 中添加存储后端。这允许对存储系统中的所有 SVM 进行全面管理。或者，可以使用ONTAP工具管理器添加存储后端并将其与 vCenter 实例关联，网址为 `https://loadBalanceIP:8443/virtualization/ui/`。使用此方法，只能在 vSphere 客户端 UI 上添加 SVM 凭据，从而提供对存储访问的更精细的控制。

====
.使用ONTAP工具配置 NFS 数据存储库
[%collapsible%open]
====
ONTAP工具集成了整个 vSphere 客户端 UI 的功能。在此步骤中，将从存储清单页面配置 NFS 数据存储。

. 在 vSphere 客户端中，导航到存储清单。
. 导航到 *ACTIONS > NetApp ONTAP工具 > 创建数据存储*。
+
image:vmware-vcf-import-nfs-006.png["创建数据存储区"]

+
{nbsp}

. 在“创建数据存储”向导中，选择要创建的数据存储的类型。选项有 NFS 或 VMFS。
. 在“名称和协议”页面上，填写数据存储的名称、大小以及要使用的 NFS 协议。
+
image:vmware-vcf-import-nfs-007.png["名称和协议"]

+
{nbsp}

. 在“存储”页面上，选择ONTAP存储平台和存储虚拟机 (SVM)。您还可以在这里选择任何可用的自定义导出策略。单击“*下一步*”继续。
+
image:vmware-vcf-import-nfs-008.png["存储页面"]

+
{nbsp}

. 在*存储属性*页面上选择要使用的存储聚合。单击“*下一步*”继续。
. 在“*摘要*”页面上，查看信息并单击“*完成*”以开始配置过程。  ONTAP工具将在ONTAP存储系统上创建一个卷，并将其作为 NFS 数据存储挂载到集群中的所有 ESXi 主机。
+
image:vmware-vcf-import-nfs-009.png["摘要页面"]



====


=== 将 vSphere 群集转换为 VCF 5.2

以下部分介绍部署 SDDC 管理器以及将 vSphere 8 集群转换为 VCF 5.2 管理域的步骤。在适当的情况下，将参考 VMware 文档以获取更多详细信息。

VCF 导入工具由 VMware by Broadcom 提供，是一款实用程序，可在 vCenter 设备和 SDDC 管理器上使用，以验证配置并为 vSphere 和 VCF 环境提供转换和导入服务。

有关更多信息，请参阅 https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/map-for-administering-vcf-5-2/importing-existing-vsphere-environments-admin/vcf-import-tool-options-and-parameters-admin.html["VCF 导入工具选项和参数"] 。

.复制并提取 VCF 导入工具
[%collapsible%open]
====
VCF 导入工具用于 vCenter 设备上，以验证 vSphere 集群在 VCF 转换或导入过程中是否处于健康状态。

完成以下步骤：

. 按照以下步骤操作 https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/copy-the-vcf-import-tool-to-the-target-vcenter-appliance.html["将 VCF 导入工具复制到目标 vCenter Appliance"]在 VMware Docs 上将 VCF 导入工具复制到正确的位置。
. 使用以下命令提取捆绑包：
+
....
tar -xvf vcf-brownfield-import-<buildnumber>.tar.gz
....


====
.验证 vCenter 设备
[%collapsible%open]
====
转换之前，使用 VCF 导入工具验证 vCenter 设备。

. 按照以下步骤操作 https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/run-a-precheck-on-the-target-vcenter-before-conversion.html["转换前对目标 vCenter 运行预检查"]运行验证。
. 以下输出显示 vCenter 设备已通过预检查。
+
image:vmware-vcf-import-nfs-011.png["vcf导入工具预检"]



====
.部署 SDDC 管理器
[%collapsible%open]
====
SDDC 管理器必须位于将转换为 VCF 管理域的 vSphere 集群上。

按照 VMware Docs 上的部署说明完成部署。

参考 https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/deploy-the-sddc-manager-appliance-on-the-target-vcenter.html["在目标 vCenter 上部署 SDDC 管理器设备"]。

有关详细信息，请参阅link:https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-1/commission-hosts.html["委员会主办方"]在 VCF 管理指南中。

====
.为 NSX 部署创建 JSON 文件
[%collapsible%open]
====
要在将 vSphere 环境导入或转换到 VMware Cloud Foundation 时部署 NSX Manager，请创建 NSX 部署规范。  NSX 部署至少需要 3 台主机。


NOTE: 在转换或导入操作中部署 NSX Manager 群集时，将使用 NSX-VLAN 网络。有关 NSX-VLAN 网络限制的详细信息，请参阅“将现有 vSphere 环境转换或导入 VMware Cloud Foundation 之前的注意事项”部分。有关 NSX-VLAN 网络限制的信息，请参阅 https://techdocs.broadcom.com/fr/fr/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/considerations-before-converting-or-importing-existing-vsphere-environments-into-vcf.html["将现有 vSphere 环境转换或导入 VMware Cloud Foundation 之前的注意事项"]。

以下是 NSX 部署的 JSON 文件示例：

....
{
  "license_key": "xxxxx-xxxxx-xxxxx-xxxxx-xxxxx",
  "form_factor": "medium",
  "admin_password": "NetApp!23456789",
  "install_bundle_path": "/tmp/vcfimport/bundle-133764.zip",
  "cluster_ip": "172.21.166.72",
  "cluster_fqdn": "vcf-m02-nsx01.sddc.netapp.com",
  "manager_specs": [{
    "fqdn": "vcf-m02-nsx01a.sddc.netapp.com",
    "name": "vcf-m02-nsx01a",
    "ip_address": "172.21.166.73",
    "gateway": "172.21.166.1",
    "subnet_mask": "255.255.255.0"
  },
  {
    "fqdn": "vcf-m02-nsx01b.sddc.netapp.com",
    "name": "vcf-m02-nsx01b",
    "ip_address": "172.21.166.74",
    "gateway": "172.21.166.1",
    "subnet_mask": "255.255.255.0"
  },
  {
    "fqdn": "vcf-m02-nsx01c.sddc.netapp.com",
    "name": "vcf-m02-nsx01c",
    "ip_address": "172.21.166.75",
    "gateway": "172.21.166.1",
    "subnet_mask": "255.255.255.0"
  }]
}
....
将 JSON 文件复制到 SDDC 管理器上的目录。

====
.将软件上传到 SDDC Manager
[%collapsible%open]
====
将 VCF 导入工具和 NSX 部署包复制到 SDDC 管理器上的 /home/vcf/vcfimport 目录。

看 https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/seed-software-on-sddc-manager.html["将所需软件上传到 SDDC 管理器设备"]以获得详细说明。

====
.将 vSphere 群集转换为 VCF 管理域
[%collapsible%open]
====
VCF 导入工具用于进行转换过程。从 /home/vcf/vcf-import-package/vcf-brownfield-import-<version>/vcf-brownfield-toolset 目录运行以下命令，查看 VCF 导入工具功能的打印输出：

....
python3 vcf_brownfield.py --help
....
执行以下命令将vSphere集群转换为VCF管理域，并部署NSX集群：

....
python3 vcf_brownfield.py convert --vcenter '<vcenter-fqdn>' --sso-user '<sso-user>' --domain-name '<wld-domain-name>' --nsx-deployment-spec-path '<nsx-deployment-json-spec-path>'
....
有关完整说明，请参阅 https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/import-workload-domain-into-sddc-manager-inventory.html["将 vSphere 环境转换或导入到 SDDC Manager 清单中"]。

====
.向 VCF 添加许可
[%collapsible%open]
====
完成转换后，必须将许可证添加到环境中。

. 登录到 SDDC 管理器 UI。
. 在导航窗格中导航至*管理>许可*。
. 点击“*+ 许可证密钥*”。
. 从下拉菜单中选择一个产品。
. 输入许可证密钥。
. 提供许可证的描述。
. 单击“*添加*”。
. 对每个许可证重复这些步骤。


====


== ONTAP tools for VMware vSphere的视频演示

.ONTAP tools for VMware vSphere的 NFS 数据存储
video::1e4c3701-0bc2-41fa-ac93-b2680147f351[panopto,width=360]