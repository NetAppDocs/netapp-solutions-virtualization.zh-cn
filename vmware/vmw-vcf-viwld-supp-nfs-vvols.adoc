---
sidebar: sidebar 
permalink: vmware/vmw-vcf-viwld-supp-nfs-vvols.html 
keywords: netapp, vmware, cloud, foundation, vcf, aff, all-flash, nfs, vvol, vvols, array, ontap tools, otv, sddc 
summary:  
---
= 使用适用ONTAP tools for VMware vSphere将 NFS 和vVols作为补充存储添加到 VI 工作负载域
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
在此用例中，我们概述了使用ONTAP Tools for VMware 将 NFS 和vVols数据存储添加为 VMware Cloud Foundation (VCF) 虚拟基础架构 (VI) 工作负载域的补充存储的过程。此过程总结了为 VMware vSphere 部署ONTAP工具、使用 NFS 逻辑接口配置存储虚拟机 (SVM) 以及配置 NFS 和vVols数据存储库。

*NFS* 用作vVols数据存储的存储协议。



== NFS 的优势

*简单易用：*NFS 设置和管理简单，使其成为需要快速简便的文件共享环境的绝佳选择。

*可扩展性*：ONTAP 的架构允许 NFS 有效扩展，从而无需对基础架构进行重大更改即可支持不断增长的数据需求。

*灵活性*：NFS 支持广泛的应用程序和工作负载，使其适用于各种用例，包括虚拟化环境。

欲了解更多信息，请参阅link:vmw-vvf-overview.html["适用于 vSphere 8 的 NFS v3 参考指南"] 。



== 场景概述

此场景涵盖以下高级步骤：

* 创建具有逻辑接口 (LIF) 的存储虚拟机 (SVM) 以用于 NFS 流量。
* 为 VI 工作负载域上的 NFS 网络创建分布式端口组。
* 在 ESXi 主机上为 VI 工作负载域创建 NFS 的 vmkernel 适配器。
* 在 VI 工作负载域上部署ONTAP工具。
* 在 VI 工作负载域上创建一个新的 NFS 数据存储。
* 在 VI 工作负载域上创建一个新的vVols数据存储。




== 前提条件

此场景需要以下组件和配置：

* ONTAP AFF或FAS存储系统，以太网交换机上具有专用于存储流量的物理数据端口。
* VCF管理域部署已完成，并且可以访问vSphere客户端。
* 之前已部署 VI 工作负载域。


NetApp建议为 NFS 采用冗余网络设计，为存储系统、交换机、网络适配器和主机系统提供容错功能。根据架构要求，通常使用单个子网或多个子网部署 NFS。

参考 https://www.vmware.com/docs/vmw-best-practices-running-nfs-vmware-vsphere["使用 VMware vSphere 运行 NFS 的最佳实践"]有关 VMware vSphere 的详细信息。

有关使用ONTAP与 VMware vSphere 的网络指导，请参阅 https://docs.netapp.com/us-en/ontap-apps-dbs/vmware/vmware-vsphere-network.html#nfs["网络配置 - NFS"]NetApp企业应用程序文档的部分。

本文档演示了创建新 SVM 和指定 IP 地址信息以创建用于 NFS 流量的多个 LIF 的过程。要将新的 LIF 添加到现有 SVM，请参阅link:https://docs.netapp.com/us-en/ontap/networking/create_a_lif.html["创建 LIF（网络接口）"]。

有关在 vSphere 群集中使用 NFS 的完整信息，请参阅link:vmw-vvf-overview.html["适用于 vSphere 8 的 NFS v3 参考指南"]。

{nbsp}image:vmware-vcf-aff-070.png["NFS架构图"] {nbsp}



== 部署步骤

要部署ONTAP工具并使用它在 VCF 管理域上创建vVols和 NFS 数据存储库，请完成以下步骤：



=== 在ONTAP存储系统上创建 SVM 和 LIF

以下步骤在ONTAP系统管理器中执行。

.创建存储虚拟机和 LIF
[%collapsible%open]
====
完成以下步骤，创建一个 SVM 以及用于 NFS 流量的多个 LIF。

. 从ONTAP系统管理器导航到左侧菜单中的 *存储虚拟机*，然后单击 *+ 添加* 开始。
+
image:vmware-vcf-asa-001.png["单击“+添加”开始创建 SVM"]

+
{nbsp}

. 在“添加存储虚拟机”向导中，为 SVM 提供一个“名称”，选择“IP 空间”，然后在“访问协议”下单击“SMB/CIFS、NFS、S3”选项卡并选中“启用 NFS”复选框。
+
image:vmware-vcf-aff-035.png["添加存储虚拟机向导 - 启用 NFS"]

+

TIP: 这里不需要选中“*允许 NFS 客户端访问*”按钮，因为将使用适用于 VMware vSphere 的 Ontap Tools 来自动化数据存储部署过程。这包括为 ESXi 主机提供客户端访问。  &#160;

. 在 *网络接口* 部分填写第一个 LIF 的 *IP 地址*、*子网掩码* 和 *广播域和端口*。对于后续 LIF，可以启用该复选框以在所有剩余 LIF 中使用通用设置或使用单独的设置。
+
image:vmware-vcf-aff-036.png["填写 LIF 的网络信息"]

+
{nbsp}

. 选择是否启用存储虚拟机管理帐户（适用于多租户环境），然后单击“*保存*”以创建 SVM。
+
image:vmware-vcf-asa-004.png["启用 SVM 帐户并完成"]



====


==== 在 ESXi 主机上设置 NFS 网络

以下步骤使用 vSphere 客户端在 VI 工作负载域集群上执行。在这种情况下，使用 vCenter Single Sign-On，因此 vSphere 客户端在管理和工作负载域中是通用的。

.为 NFS 流量创建分布式端口组
[%collapsible%open]
====
完成以下步骤来为网络创建一个新的分布式端口组来承载 NFS 流量：

. 从 vSphere 客户端，导航到工作负载域的 *Inventory > Networking*。导航到现有的分布式交换机并选择创建*新分布式端口组...*的操作。
+
image:vmware-vcf-asa-022.png["选择创建新的端口组"]

+
{nbsp}

. 在“新建分布式端口组”向导中填写新端口组的名称，然后单击“下一步”继续。
. 在*配置设置*页面上填写所有设置。如果正在使用 VLAN，请确保提供正确的 VLAN ID。单击“*下一步*”继续。
+
image:vmware-vcf-asa-023.png["填写VLAN ID"]

+
{nbsp}

. 在*准备完成*页面上，检查更改并单击*完成*以创建新的分布式端口组。
. 创建端口组后，导航到该端口组并选择操作*编辑设置...*。
+
image:vmware-vcf-aff-037.png["DPG——编辑设置"]

+
{nbsp}

. 在*分布式端口组 - 编辑设置*页面上，导航到左侧菜单中的*组合和故障转移*。确保上行链路位于“活动上行链路”区域中，以启用上行链路组合来用于 NFS 流量。将任何未使用的上行链路移至*未使用的上行链路*。
+
image:vmware-vcf-aff-038.png["DPG-- 团队上行链路"]

+
{nbsp}

. 对群集中的每个 ESXi 主机重复此过程。


====
.在每个 ESXi 主机上创建 VMkernel 适配器
[%collapsible%open]
====
在工作负载域中的每个 ESXi 主机上重复此过程。

. 从 vSphere 客户端导航到工作负载域清单中的其中一个 ESXi 主机。从*配置*选项卡中选择*VMkernel 适配器*，然后单击*添加网络...*开始。
+
image:vmware-vcf-asa-030.png["启动添加网络向导"]

+
{nbsp}

. 在*选择连接类型*窗口中选择*VMkernel 网络适配器*，然后单击*下一步*继续。
+
image:vmware-vcf-asa-008.png["选择 VMkernel 网络适配器"]

+
{nbsp}

. 在“选择目标设备”页面上，选择之前创建的 NFS 分布式端口组之一。
+
image:vmware-vcf-aff-039.png["选择目标端口组"]

+
{nbsp}

. 在*端口属性*页面上保留默认设置（未启用服务）并单击*下一步*继续。
. 在 *IPv4 设置* 页面上填写 *IP 地址*、*子网掩码*，并提供新的网关 IP 地址（仅在需要时）。单击“*下一步*”继续。
+
image:vmware-vcf-aff-040.png["VMkernel IPv4 设置"]

+
{nbsp}

. 在“准备完成”页面上检查您的选择，然后单击“完成”以创建 VMkernel 适配器。
+
image:vmware-vcf-aff-041.png["检查 VMkernel 选择"]



====


=== 部署并使用ONTAP工具配置存储

以下步骤使用 vSphere 客户端在 VCF 管理域集群上执行，包括部署 OTV、创建vVols NFS 数据存储以及将管理 VM 迁移到新的数据存储。

对于 VI 工作负载域，OTV 安装到 VCF 管理集群，但在与 VI 工作负载域关联的 vCenter 中注册。

有关在多 vCenter 环境中部署和使用ONTAP工具的更多信息，请参阅link:https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere/configure/concept_requirements_for_registering_vsc_in_multiple_vcenter_servers_environment.html["在多个 vCenter Server 环境中注册ONTAP工具的要求"]。

.ONTAP tools for VMware vSphere
[%collapsible%open]
====
ONTAP tools for VMware vSphere作为 VM 设备部署，并提供用于管理ONTAP存储的集成 vCenter UI。

完成以下步骤以部署ONTAP tools for VMware vSphere：

. ONTAPlink:https://mysupport.netapp.com/site/products/all/details/otv/downloads-tab["NetApp 支持站点"]并下载到本地文件夹。
. 登录 VCF 管理域的 vCenter 设备。
. 在 vCenter 设备界面中右键单击管理集群并选择“部署 OVF 模板...”
+
image:vmware-vcf-aff-021.png["部署 OVF 模板..."]

+
{nbsp}

. 在 *部署 OVF 模板* 向导中，单击 *本地文件* 单选按钮，然后选择上一步下载的ONTAP工具 OVA 文件。
+
image:vmware-vcf-aff-022.png["选择 OVA 文件"]

+
{nbsp}

. 对于向导的第 2 步到第 5 步，选择 VM 的名称和文件夹，选择计算资源，查看详细信息，然后接受许可协议。
. 配置和磁盘文件的存储位置选择VCF管理域集群的vSAN数据存储。
+
image:vmware-vcf-aff-023.png["选择 OVA 文件"]

+
{nbsp}

. 在选择网络页面上选择用于管理流量的网络。
+
image:vmware-vcf-aff-024.png["选择网络"]

+
{nbsp}

. 在自定义模板页面上填写所有必需的信息：
+
** 用于 OTV 管理访问的密码。
** NTP 服务器 IP 地址。
** OTV维护账户密码。
** OTV Derby DB 密码。
** 不要选中“启用 VMware Cloud Foundation (VCF)”复选框。部署补充存储不需要 VCF 模式。
** *VI 工作负载域* 的 vCenter 设备的 FQDN 或 IP 地址
** *VI 工作负载域* 的 vCenter 设备的凭证
** 提供所需的网络属性字段。
+
单击“*下一步*”继续。

+
image:vmware-vcf-aff-025.png["自定义OTV模板1"]

+
image:vmware-vcf-asa-035.png["自定义OTV模板2"]

+
{nbsp}



. 查看“准备完成”页面上的所有信息，然后单击“完成”开始部署 OTV 设备。


====
.向ONTAP工具添加存储系统。
[%collapsible%open]
====
. 通过从 vSphere 客户端的主菜单中选择NetApp ONTAP工具来访问它。
+
image:vmware-asa-006.png["NetApp ONTAP工具"]

+
{nbsp}

. 从ONTAP工具界面中的 *INSTANCE* 下拉菜单中，选择与要管理的工作负载域关联的 OTV 实例。
+
image:vmware-vcf-asa-036.png["选择OTV实例"]

+
{nbsp}

. 在ONTAP工具中，从左侧菜单中选择“*存储系统*”，然后按“*添加*”。
+
image:vmware-vcf-asa-037.png["添加存储系统"]

+
{nbsp}

. 填写存储系统的 IP 地址、凭据和端口号。单击“*添加*”开始发现过程。
+
image:vmware-vcf-asa-038.png["提供存储系统凭证"]



====
.在ONTAP工具中创建 NFS 数据存储库
[%collapsible%open]
====
完成以下步骤以使用ONTAP工具部署在 NFS 上运行的ONTAP数据存储库。

. 在ONTAP工具中选择 *概览*，然后从 *入门* 选项卡中单击 *配置* 以启动向导。
+
image:vmware-vcf-asa-041.png["配置数据存储区"]

+
{nbsp}

. 在新建数据存储向导的“常规”页面上，选择 vSphere 数据中心或集群目标。选择 *NFS* 作为数据存储类型，填写数据存储的名称，然后选择协议。选择是否使用FlexGroup卷以及是否使用存储功能文件进行配置。单击“*下一步*”继续。
+
注意：选择*在集群中分发数据存储数据*将把底层卷创建为FlexGroup卷，从而阻止使用存储功能配置文件。参考 https://docs.netapp.com/us-en/ontap/flexgroup/supported-unsupported-config-concept.html["FlexGroup卷支持和不支持的配置"]有关使用FlexGroup卷的更多信息。

+
image:vmware-vcf-aff-042.png["常规页面"]

+
{nbsp}

. 在*存储系统*页面上选择存储功能配置文件、存储系统和 SVM。单击“*下一步*”继续。
+
image:vmware-vcf-aff-043.png["存储系统"]

+
{nbsp}

. 在*存储属性*页面上选择要使用的聚合，然后单击*下一步*继续。
+
image:vmware-vcf-aff-044.png["存储属性"]

+
{nbsp}

. 最后，查看*摘要*并单击“完成”开始创建 NFS 数据存储。
+
image:vmware-vcf-aff-045.png["审核总结并完成"]



====
.在ONTAP工具中创建vVols数据存储
[%collapsible%open]
====
要在ONTAP工具中创建vVols数据存储库，请完成以下步骤：

. 在ONTAP工具中选择 *概览*，然后从 *入门* 选项卡中单击 *配置* 以启动向导。
+
image:vmware-vcf-asa-041.png["配置数据存储区"]

. 在新建数据存储向导的“常规”页面上，选择 vSphere 数据中心或集群目标。选择 * vVols* 作为数据存储类型，填写数据存储的名称，并选择 *NFS* 作为协议。单击“*下一步*”继续。
+
image:vmware-vcf-aff-046.png["常规页面"]

. 在*存储系统*页面上选择存储功能配置文件、存储系统和 SVM。单击“*下一步*”继续。
+
image:vmware-vcf-aff-043.png["存储系统"]

. 在*存储属性*页面上选择为数据存储创建一个新的卷，并填写要创建的卷的存储属性。单击“*添加*”创建卷，然后单击“*下一步*”继续。
+
image:vmware-vcf-aff-047.png["存储属性"]

+
image:vmware-vcf-aff-048.png["存储属性 - 下一步"]

. 最后，查看*摘要*并单击*完成*以启动 vVol 数据存储创建过程。
+
image:vmware-vcf-aff-049.png["摘要页面"]



====


== 追加信息

有关配置ONTAP存储系统的信息，请参阅link:https://docs.netapp.com/us-en/ontap["ONTAP 9 文档"]中心。

有关配置 VCF 的信息，请参阅link:https://techdocs.broadcom.com/us/en/vmware-cis/vcf.html["VMware 云基础文档"]。
