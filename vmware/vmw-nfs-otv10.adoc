---
sidebar: sidebar 
permalink: vmware/vmw-nfs-otv10.html 
keywords: netapp, vmware, cloud, foundation, vcf, aff, all-flash, nfs, vvol, vvols, array, ontap tools, otv, sddc 
summary:  
---
= 使用适用ONTAP tools for VMware vSphere为 vSphere 8 配置 NFS 数据存储区
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
ONTAP tools for VMware vSphere以在 vSphere 8 环境中配置 NFS 数据存储区。此过程包括为 NFS 流量创建 SVM 和 LIF、设置 ESXi 主机网络以及向 vSphere 集群注册ONTAP工具。

ONTAP tools for VMware vSphere采用下一代架构，可为 VASA 提供程序（支持 iSCSI 和 NFS vVols）实现原生高可用性和可扩展性。这简化了多个 VMware vCenter 服务器和ONTAP集群的管理。

在本场景中，我们将演示如何ONTAP tools for VMware vSphere以及如何为 vSphere 8 配置 NFS 数据存储区。



== 解决方案概述

此场景涵盖以下高级步骤：

* 创建具有逻辑接口 (LIF) 的存储虚拟机 (SVM) 以用于 NFS 流量。
* 为 vSphere 8 集群上的 NFS 网络创建分布式端口组。
* 在 vSphere 8 集群中的 ESXi 主机上为 NFS 创建 vmkernel 适配器。
* 部署ONTAP工具 10 并向 vSphere 8 集群注册。
* 在 vSphere 8 集群上创建一个新的 NFS 数据存储。




== 架构

下图显示了ONTAP tools for VMware vSphere的架构组件。

image:vmware-nfs-otv10-029.png["otv10架构"]



== 前提条件

此解决方案需要以下组件和配置：

* ONTAP AFF存储系统，其以太网交换机上有专用于存储流量的物理数据端口。
* vSphere 8集群部署完成，可以访问vSphere客户端。
* 已从NetApp支持站点下载ONTAP tools for VMware vSphere。


NetApp建议为 NFS 采用冗余网络设计，为存储系统、交换机、网络适配器和主机系统提供容错功能。根据架构要求，通常使用单个子网或多个子网部署 NFS。

参考 https://www.vmware.com/docs/vmw-best-practices-running-nfs-vmware-vsphere["使用 VMware vSphere 运行 NFS 的最佳实践"]有关 VMware vSphere 的详细信息。

有关使用ONTAP与 VMware vSphere 的网络指导，请参阅 https://docs.netapp.com/us-en/ontap-apps-dbs/vmware/vmware-vsphere-network.html#nfs["网络配置 - NFS"]NetApp企业应用程序文档的部分。

全面的ONTAP工具 10 个资源可供查找 https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/index.html["ONTAP tools for VMware vSphere文档资源"]。



== 部署步骤

要部署ONTAP工具 10 并使用它在 VCF 管理域上创建 NFS 数据存储库，请完成以下步骤：



=== 在ONTAP存储系统上创建 SVM 和 LIF

以下步骤在ONTAP系统管理器中执行。

.创建存储虚拟机和 LIF
[%collapsible%open]
====
完成以下步骤，创建一个 SVM 以及用于 NFS 流量的多个 LIF。

. 从ONTAP系统管理器导航到左侧菜单中的 *存储虚拟机*，然后单击 *+ 添加* 开始。
+
image:vmware-vcf-asa-001.png["单击“+添加”开始创建 SVM"]

+
{nbsp}

. 在“添加存储虚拟机”向导中，为 SVM 提供一个“名称”，选择“IP 空间”，然后在“访问协议”下单击“SMB/CIFS、NFS、S3”选项卡并选中“启用 NFS”复选框。
+
image:vmware-vcf-aff-035.png["添加存储虚拟机向导 - 启用 NFS"]

+

TIP: 这里不需要选中“*允许 NFS 客户端访问*”按钮，因为 VMware vSphere 的 Ontap 工具将用于自动化数据存储部署过程。这包括为 ESXi 主机提供客户端访问。  &#160;

. 在 *网络接口* 部分填写第一个 LIF 的 *IP 地址*、*子网掩码* 和 *广播域和端口*。对于后续 LIF，可以启用该复选框以在所有剩余 LIF 中使用通用设置或使用单独的设置。
+
image:vmware-vcf-aff-036.png["填写 LIF 的网络信息"]

+
{nbsp}

. 选择是否启用存储虚拟机管理帐户（适用于多租户环境），然后单击“*保存*”以创建 SVM。
+
image:vmware-vcf-asa-004.png["启用 SVM 帐户并完成"]



====


=== 在 ESXi 主机上设置 NFS 网络

以下步骤使用 vSphere 客户端在 VI 工作负载域集群上执行。在这种情况下，使用 vCenter Single Sign-On，因此 vSphere 客户端在管理和工作负载域中是通用的。

.为 NFS 流量创建分布式端口组
[%collapsible%open]
====
完成以下步骤来为网络创建一个新的分布式端口组来承载 NFS 流量：

. 从 vSphere 客户端，导航到工作负载域的 *Inventory > Networking*。导航到现有的分布式交换机并选择创建*新分布式端口组...*的操作。
+
image:vmware-nfs-otv10-001.png["选择创建新的端口组"]

+
{nbsp}

. 在“新建分布式端口组”向导中填写新端口组的名称，然后单击“下一步”继续。
. 在*配置设置*页面上填写所有设置。如果正在使用 VLAN，请确保提供正确的 VLAN ID。单击“*下一步*”继续。
+
image:vmware-vcf-asa-023.png["填写VLAN ID"]

+
{nbsp}

. 在*准备完成*页面上，检查更改并单击*完成*以创建新的分布式端口组。
. 创建端口组后，导航到该端口组并选择操作*编辑设置...*。
+
image:vmware-vcf-aff-037.png["DPG——编辑设置"]

+
{nbsp}

. 在*分布式端口组 - 编辑设置*页面上，导航到左侧菜单中的*组合和故障转移*。确保上行链路位于“活动上行链路”区域中，以启用它们进行组合，用于 NFS 流量。将任何未使用的上行链路移至*未使用的上行链路*。
+
image:vmware-nfs-otv10-002.png["DPG-- 团队上行链路"]

+
{nbsp}

. 对群集中的每个 ESXi 主机重复此过程。


====
.在每个 ESXi 主机上创建 VMkernel 适配器
[%collapsible%open]
====
在工作负载域中的每个 ESXi 主机上重复此过程。

. 从 vSphere 客户端导航到工作负载域清单中的其中一个 ESXi 主机。从*配置*选项卡中选择*VMkernel 适配器*，然后单击*添加网络...*开始。
+
image:vmware-nfs-otv10-003.png["启动添加网络向导"]

+
{nbsp}

. 在*选择连接类型*窗口中选择*VMkernel 网络适配器*，然后单击*下一步*继续。
+
image:vmware-vcf-asa-008.png["选择 VMkernel 网络适配器"]

+
{nbsp}

. 在“选择目标设备”页面上，选择之前创建的 NFS 分布式端口组之一。
+
image:vmware-nfs-otv10-004.png["选择目标端口组"]

+
{nbsp}

. 在*端口属性*页面上保留默认设置（未启用服务）并单击*下一步*继续。
. 在 *IPv4 设置* 页面上填写 *IP 地址*、*子网掩码*，并提供新的网关 IP 地址（仅在需要时）。单击“*下一步*”继续。
+
image:vmware-nfs-otv10-005.png["VMkernel IPv4 设置"]

+
{nbsp}

. 在“准备完成”页面上检查您的选择，然后单击“完成”以创建 VMkernel 适配器。
+
image:vmware-nfs-otv10-006.png["检查 VMkernel 选择"]



====


=== 部署并使用ONTAP工具 10 配置存储

以下步骤使用 vSphere 客户端在 vSphere 8 集群上执行，包括部署 OTV、配置ONTAP工具管理器以及创建vVols NFS 数据存储。

有关部署和使用适用ONTAP tools for VMware vSphere的完整文档，请参阅 https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/deploy/ontap-tools-deployment.html["ONTAP tools for VMware vSphere"]。

.ONTAP tools for VMware vSphere
[%collapsible%open]
====
ONTAP tools for VMware vSphere作为 VM 设备部署，并提供用于管理ONTAP存储的集成 vCenter UI。  ONTAP工具 10 具有一个新的全局管理门户，用于管理与多个 vCenter 服务器和ONTAP存储后端的连接。


NOTE: 在非 HA 部署场景中，需要三个可用的 IP 地址。一个 IP 地址分配给负载均衡器，另一个分配给 Kubernetes 控制平面，剩下的一个分配给节点。在 HA 部署中，除了最初的三个 IP 地址外，第二个和第三个节点还需要两个额外的 IP 地址。分配之前，主机名应该与 DNS 中的 IP 地址相关联。重要的是，所有五个 IP 地址都位于为部署选择的同一个 VLAN 上。

完成以下步骤以部署ONTAP tools for VMware vSphere：

. ONTAPlink:https://mysupport.netapp.com/site/products/all/details/otv10/downloads-tab["NetApp 支持站点"]并下载到本地文件夹。
. 登录 vSphere 8 集群的 vCenter 设备。
. 在 vCenter 设备界面中右键单击管理集群并选择“部署 OVF 模板...”
+
image:vmware-nfs-otv10-007.png["部署 OVF 模板..."]

+
{nbsp}

. 在 *部署 OVF 模板* 向导中，单击 *本地文件* 单选按钮，然后选择上一步下载的ONTAP工具 OVA 文件。
+
image:vmware-vcf-aff-022.png["选择 OVA 文件"]

+
{nbsp}

. 对于向导的第 2 步到第 5 步，选择 VM 的名称和文件夹，选择计算资源，查看详细信息，然后接受许可协议。
. 对于配置和磁盘文件的存储位置，选择本地数据存储或 vSAN 数据存储。
+
image:vmware-nfs-otv10-008.png["选择 OVA 文件"]

+
{nbsp}

. 在选择网络页面上选择用于管理流量的网络。
+
image:vmware-nfs-otv10-009.png["选择网络"]

+
{nbsp}

. 在配置页面上选择要使用的部署配置。在这种情况下，使用简单的部署方法。
+

NOTE: ONTAP Tools 10 具有多种部署配置，包括使用多个节点的高可用性部署。有关所有部署配置和先决条件的文档，请参阅 https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/deploy/prerequisites.html["ONTAP tools for VMware vSphere的前提条件"]。

+
image:vmware-nfs-otv10-010.png["选择网络"]

+
{nbsp}

. 在自定义模板页面上填写所有必需的信息：
+
** 用于在 vCenter Server 中注册 VASA 提供程序和 SRA 的应用程序用户名。
** 启用 ASUP 以实现自动化支持。
** 如果需要，请提供 ASUP 代理 URL。
** 管理员用户名和密码。
** NTP 服务器。
** 维护用户密码，用于从控制台访问管理功能。
** 负载均衡器 IP。
** K8s 控制平面的虚拟 IP。
** 主虚拟机选择当前虚拟机作为主虚拟机（适用于 HA 配置）。
** VM 的主机名
** 提供所需的网络属性字段。
+
单击“*下一步*”继续。

+
image:vmware-nfs-otv10-011.png["自定义OTV模板1"]

+
image:vmware-nfs-otv10-012.png["自定义OTV模板2"]

+
{nbsp}



. 查看“准备完成”页面上的所有信息，然后单击“完成”开始部署ONTAP工具设备。


====
.将存储后端和 vCenter Server 连接到ONTAP工具 10。
[%collapsible%open]
====
ONTAP工具管理器用于配置ONTAP工具 10 的全局设置。

. 通过导航ONTAP `https://<loadBalanceIP>:8443/virtualization/ui/`在 Web 浏览器中，使用部署期间提供的管理凭据登录。
+
image:vmware-nfs-otv10-013.png["ONTAP工具管理器"]

+
{nbsp}

. 在*入门*页面上单击*转到存储后端*。
+
image:vmware-nfs-otv10-014.png["入门"]

+
{nbsp}

. 在 *存储后端* 页面上，单击 *添加* 以填写要使用ONTAP工具 10 注册的ONTAP存储系统的凭据。
+
image:vmware-nfs-otv10-015.png["添加存储后端"]

+
{nbsp}

. 在*添加存储后端*框中，填写ONTAP存储系统的凭据。
+
image:vmware-nfs-otv10-016.png["添加存储后端"]

+
{nbsp}

. 在左侧菜单中单击“*vCenters*”，然后单击“*ADD*”以填写要使用ONTAP tools 10 注册的 vCenter 服务器的凭据。
+
image:vmware-nfs-otv10-017.png["添加 vCenter 服务器"]

+
{nbsp}

. 在*添加 vCenter*框中，填写ONTAP存储系统的凭据。
+
image:vmware-nfs-otv10-018.png["添加存储存储凭证"]

+
{nbsp}

. 从新发现的 vCenter 服务器的垂直三点菜单中，选择 *关联存储后端*。
+
image:vmware-nfs-otv10-019.png["关联存储后端"]

+
{nbsp}

. 在*关联存储后端*框中，选择要与 vCenter 服务器关联的ONTAP存储系统，然后单击*关联*以完成操作。
+
image:vmware-nfs-otv10-020.png["选择要关联的存储系统"]

+
{nbsp}

. 要验证安装，请登录 vSphere 客户端并从左侧菜单中选择 * NetApp ONTAP工具 *。
+
image:vmware-nfs-otv10-021.png["访问ONTAP工具插件"]

+
{nbsp}

. 从ONTAP工具仪表板中，您应该看到存储后端与 vCenter Server 相关联。
+
image:vmware-nfs-otv10-022.png["ONTAP工具仪表板"]

+
{nbsp}



====
.使用ONTAP工具 10 创建 NFS 数据存储库
[%collapsible%open]
====
完成以下步骤以使用ONTAP工具 10 部署在 NFS 上运行的ONTAP数据存储库。

. 在 vSphere 客户端中，导航到存储清单。从 *ACTIONS* 菜单中，选择 * NetApp ONTAP工具 > 创建数据存储*。
+
image:vmware-nfs-otv10-023.png["ONTAP工具 - 创建数据存储库"]

+
{nbsp}

. 在创建数据存储向导的“*类型*”页面上，单击“NFS”单选按钮，然后单击“*下一步*”继续。
+
image:vmware-nfs-otv10-024.png["选择数据存储类型"]

+
{nbsp}

. 在*名称和协议*页面上，填写数据存储的名称、大小和协议。单击“*下一步*”继续。
+
image:vmware-nfs-otv10-025.png["选择数据存储类型"]

+
{nbsp}

. 在*存储*页面上，选择一个平台（按类型过滤存储系统）和一个用于卷的存储虚拟机。或者，选择自定义导出策略。单击“*下一步*”继续。
+
image:vmware-nfs-otv10-026.png["存储页面"]

+
{nbsp}

. 在“存储属性”页面上，选择要使用的存储聚合，以及可选的高级选项，例如空间预留和服务质量。单击“*下一步*”继续。
+
image:vmware-nfs-otv10-027.png["存储属性页面"]

+
{nbsp}

. 最后，查看*摘要*并单击“完成”开始创建 NFS 数据存储。
+
image:vmware-nfs-otv10-028.png["审核总结并完成"]



====
.使用ONTAP工具 10 调整 NFS 数据存储库的大小
[%collapsible%open]
====
完成以下步骤，使用ONTAP工具 10 调整现有 NFS 数据存储库的大小。

. 在 vSphere 客户端中，导航到存储清单。从 *ACTIONS* 菜单中，选择 * NetApp ONTAP tools > Resize datastore*。
+
image:vmware-nfs-otv10-030.png["选择调整数据存储大小"]

+
{nbsp}

. 在“调整数据存储大小”向导中，填写数据存储的新大小（以 GB 为单位），然后单击“调整大小”继续。
+
image:vmware-nfs-otv10-031.png["调整数据存储区大小向导"]

+
{nbsp}

. 在“最近任务”窗格中监控调整大小作业的进度。
+
image:vmware-nfs-otv10-032.png["最近任务窗格"]

+
{nbsp}



====


== 追加信息

有关适用ONTAP tools for VMware vSphere的完整列表，请参阅 https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/index.html["ONTAP tools for VMware vSphere文档资源"]。

有关配置ONTAP存储系统的更多信息，请参阅link:https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/["ONTAP 10 文档"]中心。
