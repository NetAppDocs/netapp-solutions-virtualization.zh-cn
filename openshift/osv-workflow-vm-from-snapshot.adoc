---
sidebar: sidebar 
permalink: openshift/osv-workflow-vm-from-snapshot.html 
keywords: OpenShift, OCP, Trident, NetApp ONTAP, Red Hat OpenShift, OpenShift Virtualization, CNV, Container Native Virtualization, Red Hat OpenShift Virtualization 
summary: 搭载NetApp ONTAP 的Red Hat OpenShift 虚拟化 
---
= 使用 Red Hat OpenShift Virtualization 从快照副本创建 VM
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
使用 OpenShift Virtualization 从快照创建 VM。此过程包括创建 VolumeSnapshotClass、对 VM 的持久卷声明 (PVC) 进行快照、将快照还原到新的 PVC 以及部署使用还原的 PVC 作为根磁盘的新 VM。



== 从快照创建虚拟机

借助Trident和 Red Hat OpenShift，用户可以对其所配置的存储类上的持久卷进行快照。利用此功能，用户可以获取卷的某个时间点的副本并使用它来创建新卷或将同一卷恢复到以前的状态。这启用或支持各种用例，从回滚到克隆到数据恢复。

对于 OpenShift 中的 Snapshot 操作，必须定义资源 VolumeSnapshotClass、VolumeSnapshot 和 VolumeSnapshotContent。

* VolumeSnapshotContent 是从集群中的卷获取的实际快照。它是类似于用于存储的 PersistentVolume 的集群范围的资源。
* VolumeSnapshot 是创建卷快照的请求。它类似于 PersistentVolumeClaim。
* VolumeSnapshotClass 允许管理员为 VolumeSnapshot 指定不同的属性。它允许您对从同一卷获取的不同快照设置不同的属性。


image:redhat-openshift-060.png["快照架构的虚拟机"]

要创建虚拟机的快照，请完成以下步骤：

. 创建一个 VolumeSnapshotClass，然后可以使用它来创建 VolumeSnapshot。导航到存储>VolumeSnapshotClasses，然后单击创建VolumeSnapshotClass。
. 输入快照类的名称，输入驱动程序的 csi.trident.netapp.io，然后单击创建。
+
image:redhat-openshift-061.png["创建快照类"]

. 识别连接到源虚拟机的 PVC，然后创建该 PVC 的快照。导航至 `Storage > VolumeSnapshots`并单击创建卷快照。
. 选择要为其创建 Snapshot 的 PVC，输入 Snapshot 的名称或接受默认值，并选择适当的 VolumeSnapshotClass。然后单击“创建”。
+
image:redhat-openshift-062.png["创建 Snapshot"]

. 这将创建该时间点的 PVC 快照。




== 从快照创建新的虚拟机

. 首先，将快照恢复到新的 PVC 中。导航到存储 > VolumeSnapshots，单击要恢复的快照旁边的省略号，然后单击恢复为新 PVC。
. 输入新 PVC 的详细信息，然后单击“恢复”。这将创建一个新的 PVC。
+
image:redhat-openshift-063.png["将快照恢复到新的 PVC"]

. 接下来，从此 PVC 创建一个新的 VM。导航到“虚拟化”>“虚拟机”，然后单击“创建”>“使用 YAML”。
. 在 spec > template > spec >volumes 部分中，指定从快照而不是从容器磁盘创建的新 PVC。根据您的要求提供新虚拟机的所有其他详细信息。
+
[source, cli]
----
- name: rootdisk
  persistentVolumeClaim:
    claimName: rhel8-short-frog-rootdisk-28dvb-snapshot-restore
----
. 单击“创建”以创建新的虚拟机。
. 虚拟机创建成功后，访问并验证新虚拟机与创建快照时使用 PVC 创建的虚拟机的状态是否相同。

